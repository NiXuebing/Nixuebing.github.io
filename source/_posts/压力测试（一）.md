---
title: 压力测试（一）
date: 2019-01-02 13:52:35
tags:
  - 压力测试
categories:
  - 高并发架构
---

# 一、服务器性能指标

## 平均负载、CPU、内存

**指标**：**平均负载不高于CPU数量70%，CPU和内存使用量不超过80%**

**监控方法：**

`top`，`free -h` 查看实时的CPU、内存等多项指标

`watch -d uptime`  查看平均负载

`mpstat -P ALL 5`  监控所有 CPU，后面数字 5 表示间隔5秒输出一组数据

<!-- more -->

## 网络IO

使用`ifconfig`查看服务器正在使用的网卡

**监控方法：**

`nload eth0`

# 二、压测指标

## 平均响应时间、中位数响应时间

可能由于部分请求响应过慢会导致平均响应时间相对偏大，相对而言中位数稍微靠谱一点。

## TP90、TP95、TP99

用百分比分布统计。

## 吞吐量

系统的性能如果只看吞吐量，不看响应时间是没有意义的。我的系统可以顶10万请求，但是响应时间已经到了5秒钟，这样的系统已经不可用了，这样的吞吐量也是没有意义的。

所以，**吞吐量的值必需有响应时间来卡。**比如：**TP99小于100ms的时候，系统可以承载的最大并发数是1000qps**。这意味着，我们要不断的在不同的并发数上测试，以找到软件的最稳定时的最大吞吐量。

## 成功率

保证系统稳定性

# 压测流程

一、定义一个系统的响应时间latency，建议是TP99，以及成功率。

二、在这个响应时间的限制下，找到最高的吞吐量。

三、在最大吞吐量下做浸泡测试，观察CPU、内存、网络IO等。如果指标平稳，这个值就是系统性能。

四、找系统极限值，在保证成功率100%，不考虑响应时长的情况下，系统能坚持10分钟的吞吐量。

五、**用第二步得到的吞吐量执行5分钟，然后在第四步得到的极限值执行1分钟，再回到第二步的吞吐量执行5钟，再到第四步的权限值执行1分钟，如此往复个一段时间，比如2天。**收集系统数据：CPU、内存、硬盘/网络IO等，观察他们的曲线，以及相应的响应时间，确保系统是稳定的。

# 压测方法

一、 确定测试接口和接口逻辑，构造请求参数和jmeter脚本。本次以空接口为例。

![mark](http://pic-cloud.ice-leaf.top/pic-cloud/20190103/5xwTaXWwPPC1.png?imageslim)

Jmeter脚本：

![mark](http://pic-cloud.ice-leaf.top/pic-cloud/20190103/akoq3io8horJ.png?imageslim)

二、指定响应时间指标。

TP99 < 50ms，成功率 100%

三、上传jmeter脚本

./jmeter -n -r -t /root/test02.jmx -l /root/02.jtl -j /root/02.log

![mark](http://pic-cloud.ice-leaf.top/pic-cloud/20190103/uR3YR5qi863x.png?imageslim)

四、本地jmeter加载结果分析

![mark](http://pic-cloud.ice-leaf.top/pic-cloud/20190103/JlG1LDFb0m2f.png?imageslim)









