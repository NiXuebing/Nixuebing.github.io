---
title: 集群搭建（一）
date: 2019-01-22 21:58:00
tags:
  - 集群搭建
categories:
  - 高并发架构
---

# Zookeeper 

<!--more-->

# Rabbitmq

## 安装ERLANG

```
vim /etc/yum.repos.d/rabbitmq-erlang.repo

# In /etc/yum.repos.d/rabbitmq-erlang.repo
[rabbitmq-erlang]
name=rabbitmq-erlang
baseurl=https://dl.bintray.com/rabbitmq/rpm/erlang/20/el/7
gpgcheck=1
gpgkey=https://dl.bintray.com/rabbitmq/Keys/rabbitmq-release-signing-key.asc
repo_gpgcheck=0
enabled=1

yum install erlang
```

## 安装rabbitmq

注意Rabbitmq和Erlang的版本

![mark](http://pic-cloud.ice-leaf.top/pic-cloud/20190121/KNqB0hw0TbE9.png?imageslim)



```
wget https://dl.bintray.com/rabbitmq/all/rabbitmq-server/3.7.6/rabbitmq-server-3.7.6-1.el7.noarch.rpm

rpm --import https://www.rabbitmq.com/rabbitmq-release-signing-key.asc

yum install rabbitmq-server-3.7.6-1.el7.noarch.rpm

```

## 设置rabbitmq（单机）

```
# 设置rabbitmq开机自启动
chkconfig rabbitmq-server on

# 新建rabbitmq.config，设置默认账号密码
vi /etc/rabbitmq/rabbitmq.config
[{rabbit,[{hipe_compile,false},
          {tcp_listeners, [5670]},
          {loopback_users,[]},
          {default_user,<<"root">>},
          {default_pass,<<"Flnet2018">>}]},
{rabbitmq_management, [{listener, [{port, 15670}]}]}
].

# 启动rabbitmq
systemctl start rabbitmq-server
systemctl status rabbitmq-server

# 启动后台页面
rabbitmq-plugins enable rabbitmq_management

```

# ElasticSearch

## 安装ES

```
wget https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-5.5.0.tar.gz

tar zxvf elasticsearch-5.5.0.tar.gz

```

## 配置ES

```
vi config/elasticsearch.yml
# 禁止消息自动创建索引
action.auto_create_index: false
# 禁止通配符删除索引
action.destructive_requires_name: true
```

## 启动ES

```
# ES 无法使用root，创建新用户
useradd es

chown -R es: elasticsearch-5.5.0/

./elasticsearch -d
```

## 处理报错

```
max virtual memory areas vm.max_map_count [65530] is too low, increase to at least [262144]

vim /etc/sysctl.conf
vm.max_map_count=655360
sysctl -p


max file descriptors [65535] for elasticsearch process is too low, increase to at least [65536]

vim /etc/security/limits.conf
* soft nofile 65536
* hard nofile 65536

```

# Kibana

## 安装Kibana

```
wget https://artifacts.elastic.co/downloads/kibana/kibana-5.5.0-linux-x86_64.tar.gz
```

# Netdata

```
yum -y install zlib-devel libuuid-devel libmnl-devel gcc make git autoconf autogen automake pkgconfig curl jq nodejs

git clone https://github.com/firehol/netdata.git --depth=1

./netdata-installer.sh --install /usr/local/server	
```

